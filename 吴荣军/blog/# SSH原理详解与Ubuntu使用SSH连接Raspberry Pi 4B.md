# SSH原理详解与Ubuntu使用SSH连接Raspberry Pi 4B

### SSH介绍

	SSH全称为Secure Shell,中文名称为"安全壳协议".
	
	总的来说，SSH是一种网络传输协议，它可以用来传递文件和数据，只不过它更安全，更方便.  


### SSH原理
	对称加密
	非对称加密

对称加密:

		我们使用一个密码加密某个文件，然后我把这个文件发送给对方，如果对方想要解密的话，那么   
		我就需要告诉他我用来加密这个文件的密码，方能打开．
		
		（此处可有图片）
		
		上面所说的就是一个对称加密的例子，它的大致原理就是用同一个密码加密，用同一个密码解密．

非对称加密：

		然而非对称加密就不一样了，经过非对称加密算法加密过的文件会产生两个密钥，一个是公开密 
		
	    钥(公钥)，另一个则是私有密钥(密钥)．那要如何打开加密过的文件呢？我们举一个例子：
	    
	    		假设你有一个邮箱，但是这个邮箱有两把锁，一把锁是上在邮件的投递口，你可以把这个所
	    		
	    		锁的钥匙挂在旁边，这样每个人都可以向你投递邮件了，当然你也可以把这个钥匙复制多
	    		
	    		份，然后把他发放给你的朋友们，这样就只有你的朋友可以向你投递邮件了．
	    		
	    		另一个锁是上在邮箱的＂大门＂，只有拥有这个＂大门＂的钥匙的人－－也就是
	    		
	    		你，才可以打开邮箱，拿到邮件．
	    	
		上面的这个例子，就是一个SSH加密过程以及公钥与私钥的问题了．那把挂在邮箱旁边的钥匙其
		
		实就是"公钥"，我们可以把它暴露在外面，只要主人愿意，谁都可以往他的邮箱里向你投递邮件
		
		而"大门"钥匙其实就是私钥，只有邮箱的主人才可以打开邮箱，拿到里面的邮件．所以我们要保
		
		护好我们的私钥，不然里面的邮件会被人拿走．


###  使用Ubuntu连接Raspberry Pi 4B

					我们知道，SSH是连接两台电脑的服务协议，这就意味着着这个过程中，有一台是客户
					
					端，而另一台则是服务端，我们把发送连接请求的电脑叫做客户端，而接受请求连接的叫
					
					做服务端，那么，在我们的这个实例中，Ubuntu电脑就是我们的客户端，Raspberry Pi 
					
					4B就是服务端了．
					
					首先，我是把Raspberry Pi 4B插在了我家的wifi上，然后我再登陆上我家的wifi管理界
					
					面，也就是浏览器中输入地址栏: 192.168.1.1就可以进入到家里的wifi管理界面，我们就
					
					可以看到wifi分配给Raspberry Pi 4B的IP地址了．(！！！插入图片！！！)
					
					由于linux系统是自带ssh连接工具的，(在这里提醒一下windows的读者，由于windows
					
					系统本身是没有ssh连接工具的，所以，window一般要下载ssh连接工具，比如: xshell,才
					
					可以使用ssh连接到别的电脑),所以我们可以直接打开命令行，输入命令：
					
					[alarm@alarmpi ssh]# ssh alarm@192.168.1.2
					或者
					[root@alarmpi ssh]# ssh root@192.168.1.2
					
					对上面的两条命令做一下解释，命令中的ssh表示我们启用ssh服务，而root和alarm是树
					
					莓派的两个默认用户名，所以我们在连接其他的电脑的时候，要先知道对方的用户名，才
					
					可以进行ssh连接，而后面的就是树莓派的IP地址了．


​					<img src="/home/shit/图片/屏幕截图/2020-02-19 20-41-56 的屏幕截图.png" alt="SSH登录"  />
​					之后系统会提示我们输入用户的密码，而树莓派的alarm用户默认密码就是alarm，我们					
​					输入密码之后，就可以进入树莓派了．

### SSH密钥对登录

​		既然我们已经使用到了SSH,那么我们就应该要使用一下SSH非对称加密算法来进行我

们的SSH远程连接．

​		首先我们要先在客户端生成一个新的钥匙对，即为公钥和私钥

​		我们先在命令行输入生成钥匙对的命令：

​		ssh-keygen -t rsa

​		命令输入之后，理论上，只要一直按回车就好，因为系统询问你的问题无非是密钥对的

存放位置和是否使用密码来管理密钥对，这些配置其实只要按照默认的设置来做就好了．



​						![](/home/shit/图片/2020-02-20 00-05-19 的屏幕截图.png)



​		由于我之前已经生成过了钥匙对，但是但是我只想懒得把这个新生成的钥匙对放在其他

文件夹里面，所以我就对原来的存在的钥匙对，做了一个覆盖．这个时候钥匙对已经生成完

毕了．上面是公钥的算法图.



​										![](/home/shit/图片/2020-02-20 14-11-31 的屏幕截图.png)



​		我们在进入到.ssh目录中去查看时，会发现多了三个文件：id_ras, id_rsa.pub, known_hosts

id_rsa文件是用来存储钥匙对的私钥的，一定要保管好

id_rsa.pub文件是用来钥匙对的公钥的，等一下我们要把这个公钥复制给远程服务器

known_hosts文件是用来存放远程服务器的公钥的保存位置的



客户端这边的钥匙对生成完毕之后，我们就需要把这个公钥上传到服务端了，我们在客服端命令行执行命令：



scp id_ras.pub root@192.168.1.2:/root



![](/home/shit/图片/2020-02-20 14-18-49 的屏幕截图.png)



我们再到服务端看看：

![](/home/shit/图片/2020-02-20 14-19-31 的屏幕截图.png)



我们可以看到，root目录下，真的多了一个id_rsa.pub文件，这证明我们传输公钥成功了！



接来下我们要确认想让服务端的哪个用户使用这个公钥，我们就把这个公钥保存在哪个用户的家目录下，现在我打

算让root用户适应这个公钥，所以我就把这个公钥保存在root的家目录下了．



并且我们还需要创建一个".ssh"文件夹来存放这个公钥,所以我执行命令：



mkdir .ssh

![](/home/shit/图片/2020-02-20 14-25-08 的屏幕截图.png)



我们本来是把id_rsa.pub这个文件放在和.ssh同级的目录下的，所以现在我们为了把这个文件放在.ssh目录下，我么需要执行一个命令来重定向这个文件的位置

cat id_rsa.pub >> .ssh/authorized_keys

注意这个authorized_keys文件名不可以写错！！



![](/home/shit/图片/2020-02-20 14-30-01 的屏幕截图.png)



重定向完毕！！!



接下来，我们要去服务端的/etc/ssh/sshd_config配置文件中去修改相关的配置文件．执行命令

sudo vim /etc/ssh.sshd_config



接下来我们要做的事情有那么几件：

1.RSAAuthentication yes            开启RSA验证

2.PubkeyAuthentication yes    是否使用公钥对登录

3.AUthorizedKeysFile    .ssh/authorized_keys  公钥的保存位置

4.PasswordAuthentication no     禁止使用密码登录　



前面我们说过，sshd_config文件中的代码都是使用注释来使用注释提供的默认值的，所以我们只要去掉"#"然后把后面的参数值改掉就行了．



![](/home/shit/图片/2020-02-20 14-39-24 的屏幕截图.png)



大家看黄色的部分就是我们需要修改的部分了，修改完成后，保存退出,并且退出SSH服务，重启服务端

我们再来执行命令来连接服务段

ssh root@192.168.1.2

![](/home/shit/图片/2020-02-20 14-41-19 的屏幕截图.png)



我们可以看到，这次，服务端不会再要求我们输入密码，我们命令打完就直接进入到了服务端了！